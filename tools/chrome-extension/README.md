# Chrome 插件 - 视频转文字稿助手

这个 Chrome 插件可以帮助你快速选择 B 站或 YouTube 视频，并将它们批量添加到 `videos.json` 文件中，方便后续使用 `batch_whisperx.py` 批量处理。

## ✨ 功能特点

- ✅ **视频列表选择**：在视频列表页面，每个视频项上会显示悬浮的选择按钮（✓）
- ✅ **持久化存储**：选择状态保存在浏览器中，刷新页面后仍然保持
- ✅ **批量管理**：在插件弹窗中查看所有已选择的视频，支持批量添加
- ✅ **自动识别**：自动识别 B 站和 YouTube 的视频列表页面
- ✅ **灵活命名**：支持自动生成名称或手动编辑每个视频的名称

## 📦 安装步骤

### 1. 加载插件到 Chrome

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `tools/chrome-extension` 文件夹

### 2. 创建图标文件（可选）

插件需要图标文件，如果还没有，可以：
- 运行 `python generate_icons.py` 自动生成
- 或手动创建 `icons` 文件夹并添加图标文件（见 `icons/README.md`）

### 3. 启动本地服务器（推荐）

为了直接写入 `videos.json`，需要运行本地服务器：

```bash
cd tools
python server.py
```

服务器会在 `http://localhost:8765` 启动。

## 🎯 使用方法

### 步骤 1: 选择视频

1. 访问 B 站或 YouTube 的视频列表页面（如搜索结果、频道页、首页等）
2. 每个视频项上会显示一个绿色的 **✓** 按钮
3. 点击 **✓** 按钮选择视频（按钮会变成蓝色表示已选择）
4. 再次点击可以取消选择
5. **刷新页面后，选择状态仍然保持**

### 步骤 2: 批量添加

1. 点击浏览器工具栏中的插件图标
2. 在弹窗中查看所有已选择的视频
3. 可以编辑每个视频的名称（用于生成文件名）
4. 选择"自动生成视频名称"或手动编辑
5. 点击"批量添加到 videos.json"按钮
6. 所有视频会自动添加到配置文件中

### 步骤 3: 批量处理

```bash
python batch_whisperx.py
```

脚本会自动读取 `videos.json`，下载所有视频的音频，转写为文字稿，并使用 AI 整理。

## 🎨 界面说明

### 视频列表页面

- **绿色 ✓ 按钮**：未选择的视频
- **蓝色 ✓ 按钮**：已选择的视频
- 按钮位于视频项的右上角，鼠标悬停会放大

### 插件弹窗

- **视频列表**：显示所有已选择的视频
- **名称输入框**：为每个视频设置文件名
- **批量添加按钮**：将所有视频添加到 `videos.json`
- **清空所有选择**：清除所有已选择的视频
- **自动生成名称**：勾选后自动为视频生成名称

## 🔧 支持的页面

### B 站 (bilibili.com)

- ✅ 搜索结果页
- ✅ 分区页面
- ✅ 用户主页
- ✅ 推荐页面
- ✅ 其他视频列表页面

### YouTube

- ✅ 首页
- ✅ 搜索结果页
- ✅ 频道页面
- ✅ 播放列表
- ✅ 其他视频列表页面

## 📝 注意事项

- 确保在**视频列表页面**使用插件（不是单个视频播放页）
- 视频名称会用作生成的文件名，建议使用简洁的英文或数字
- 如果本地服务器未运行，插件会提示并显示 JSON 供手动复制
- 选择状态保存在浏览器本地，清除浏览器数据会丢失选择

## ❓ 常见问题

**Q: 为什么看不到选择按钮？**

A: 确保你在视频列表页面（不是单个视频播放页），并且页面已完全加载。如果还是没有，尝试刷新页面。

**Q: 刷新页面后选择状态丢失？**

A: 确保插件已正确安装，并且浏览器允许插件使用存储权限。检查 `chrome://extensions/` 中插件的权限设置。

**Q: 无法连接到服务器？**

A: 确保已运行 `python tools/server.py`，并且端口 8765 未被占用。也可以使用"复制 JSON"功能手动添加。

**Q: 如何清空所有选择？**

A: 在插件弹窗中点击"清空所有选择"按钮。

## 🔄 工作流程

```
1. 在视频列表页面选择视频（点击 ✓ 按钮）
   ↓
2. 打开插件弹窗查看已选择的视频
   ↓
3. 编辑视频名称（可选）
   ↓
4. 批量添加到 videos.json
   ↓
5. 运行 batch_whisperx.py 批量处理
   ↓
6. 获得所有视频的文字稿和摘要
```
